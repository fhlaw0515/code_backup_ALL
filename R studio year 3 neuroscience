# dataframe naming too long, code need tidy up
# condition to interpret skewness value useful, reused in final year 
# ddply summarise statistics useful, reused in final year 

############### create statistics for percentage of All drugs ############################
library(e1071)
library(plyr)

Four_drugs_with_format <- rbind.data.frame(Adrenaline_ALL_no_NA,Atropine_ALL_no_NA,Propranolol_ALL_no_NA,ACh_ALL_no_NA)
#View(Four_drugs_with_format)

Four_drugs_with_format$Concentration<-factor(Four_drugs_with_format$Concentration,levels=c("Control","1x10^-6","1x10^-5","1x10^-4","1x10^-3"))
#View(Four_drugs_with_format)

skewness.Heart_rate_percentage_All_Drugs<-ddply(Four_drugs_with_format,c("Treatment","Concentration"),summarise,skewness.Heart_rate_percentage=skewness(Heart_rate_percentage))
write.csv(skewness.Heart_rate_percentage_All_Drugs,"skewness.Heart_rate_percentage_All_Drugs.csv",row.names=F)
#View(skewness.Heart_rate_percentage_All_Drugs)

skewness.Heart_rate_percentage_All_Drugs <- skewness.Heart_rate_percentage_All_Drugs %>% mutate(Skewness_Value_Meaning = "IDK")
skewness.Heart_rate_percentage_All_Drugs$Skewness_Value_Meaning [skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage > 1] <- "Not normal distributed and positively Skewed"
skewness.Heart_rate_percentage_All_Drugs$Skewness_Value_Meaning [skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage < -1] <- "Not normal distributed and negatively Skewed"
skewness.Heart_rate_percentage_All_Drugs$Skewness_Value_Meaning [skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage > 0 & skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage < 0.5] <- "Fairly symmetrical (Positive)"
skewness.Heart_rate_percentage_All_Drugs$Skewness_Value_Meaning [skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage < 0 & skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage > -0.5] <- "Fairly symmetrical (Negative)"
skewness.Heart_rate_percentage_All_Drugs$Skewness_Value_Meaning [skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage > 0.5 & skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage < 1] <- "Moderately Skewed (Positive)"
skewness.Heart_rate_percentage_All_Drugs$Skewness_Value_Meaning [skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage < -0.5 & skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage > -1] <- "Moderately Skewed (Negative)"

write.csv(skewness.Heart_rate_percentage_All_Drugs,"skewness.Heart_rate_percentage_All_Drugs.csv",row.names=F)

backupdataframe <- skewness.Heart_rate_percentage_All_Drugs
backupdataframe <- backupdataframe %>% mutate(Normality = "Yes")
#View(backupdataframe)
backupdataframe$Normality [backupdataframe$skewness.Heart_rate_percentage < -1 | backupdataframe$skewness.Heart_rate_percentage > 1] <- "No"

Statistics_All_Drugs_Normalilty <- backupdataframe
write.csv(Statistics_All_Drugs_Normalilty,"Statistics_All_Drugs_Normalilty.csv",row.names=F)
#View(Statistics_All_Drugs_Normalilty)





###############################   Generate SD, Mean, SEM  #######################################

write.csv(Four_drugs_with_format,"Four_drugs_with_format.csv",row.names=F)
#View(Four_drugs_with_format)

stats.Heart_Rate_Four_Drugs<-ddply(Four_drugs_with_format,c("Treatment","Concentration"),summarise,N=length(Heart_rate_percentage),mean=mean(Heart_rate_percentage),
                                   sd=sd(Heart_rate_percentage),
                                   se=sd/sqrt(N),
                                   sum=sum(Heart_rate_percentage),
                                   median=median(Heart_rate_percentage) ,
                                   IQR=IQR(Heart_rate_percentage,type=6)
                                   )
#View(stats.Heart_Rate_Four_Drugs)
write.csv(stats.Heart_Rate_Four_Drugs,"stats.Heart_Rate_Four_Drugs.csv",row.names=F)

df1 <- Statistics_All_Drugs_Normalilty [,3:5]
#View(df1)
ALL_Stat_Four_Drugs <- cbind(stats.Heart_Rate_Four_Drugs,df1)
#View(ALL_Stat_Four_Drugs)
write.csv(ALL_Stat_Four_Drugs,"ALL_Stat_Four_Drugs.csv",row.names=F)




############################################# Example code stat workshop
Placebo.0months<-subset(metformin,Time=="0_months"&Treatment=="Placebo")
Placebo.0months.HbA1c<-(Placebo.0months$HbA1c)
hist(Placebo.0months.HbA1c)
To add an x-axis label:
  xlab="HbA1c"
To add a title: 
  main="Histogram of HbA1c data from patients treated for 0 months with placebo"
To change the font of the axis annotation (1=normal; 2=bold; 3=italic; 4=italic and bold):
  font.axis=2
To change the font of the axis labels:
  font.lab=2

summary(Placebo.0months.HbA1c)
summary(Placebo.0months)
mean(mydata$myvariable)     
median(mydata$myvariable)
max(mydata$myvariable)
min(mydata$myvariable)

means<-aggregate(Body_Weight~Time+Treatment,data=metformin,FUN="mean")

std_errors<-aggregate(Body_Weight~Time+Treatment,data=metformin,FUN=function(x)sd(x)/sqrt(length(x)))

where FUN=the appropriate function (eg. mean)
  

########################

stats.Body_weight<-ddply(metformin,c("Time","Treatment"),summarise,N=length(Body_Weight),mean=mean(Body_Weight))
sd=sd(Body_Weight)
se=sd/sqrt(N)
sum=sum(Body_Weight)
median=median(Body_Weight) 
IQR=IQR(Body_Weight,type=6)
View(stats.Body_weight)

#################################################



df<- skewness.Heart_rate_percentage_All_Drugs[skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage > 1|skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage < -1,]
View(df)

df1$Skewness_Value_Meaning [df1$skewness.Heart_rate_percentage <-1] <- "Not normal distributed and negatively Skewed"
View(df1)
View(skewness.Heart_rate_percentage_All_Drugs)

 |skewness.Heart_rate_percentage_All_Drugs$skewness.Heart_rate_percentage < -1]
################################### Metformin example copied from sattistic workshop I ##################
library(e1071)
library(plyr)
metformin$Treatment<-factor(metformin$Treatment,levels=c("Placebo","Metformin","Drug_A","Drug_B"))
skewness.Body_Weight<-ddply(metformin,c("Treatment","Time"),summarise,skewness.Body_Weight=skewness(Body_Weight))
write.csv(skewness.Body_Weight,"skewness.Body_Weight.csv",row.names=F)

#################################

skewness.Heart_rate_percentage<-ddply(ALL_no_NA,c("Treatment"),summarise,skewness.Heart_rate_percentage=skewness(Heart_rate_percentage))
write.csv(skewness.Heart_rate_percentage,"skewness.Heart_rate_percentage_propranolol.csv",row.names=F)

Propranolol_control<-subset(ALL_no_NA,Treatment=="Control")
View(Propranolol_control)
Propranolol_control.Heart_rate_percentage<-(Propranolol_control$Heart_rate_percentage)
View(Propranolol_control.Heart_rate_percentage)
hist(Propranolol_control.Heart_rate_percentage, 
     xlab="Heart rate (% of control)",
     main="Histogram of heart rate data from Daphnia with control for Propranolol",
     font.axis=1,
     font.label=1)
